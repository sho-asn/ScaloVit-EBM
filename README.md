# ScaloVit-EBM Repository

This repository accompanies the paper **“ScaloVit-EBM: Localized Energy-Based Anomaly Detection on Time–Frequency Scalograms”**. It contains the code needed to preprocess the Cranfield three-phase flow dataset, train the ScaloVit-EBM model, and run the evaluation pipelines described in the manuscript.

## Repository Layout

- `scalovit/`: Python package containing models, data preprocessing helpers, evaluation utilities, and transforms used in the paper.
- `preprocess_data.py`: CLI wrapper that calls `scalovit.data.preprocessing.preprocess`.
- `train_ebm.py`, `train_ebm_ablation.py`: training entry points for the main model and ablation variants (using `scalovit.training.loop`).
- `detect_anomalies.py`, `detect_anomalies_ablation.py`: evaluation entry points backed by `scalovit.detection.pipeline`.
- `paper/`: LaTeX source, final PDF, and supporting materials for the manuscript.
- `requirements.txt`: Python dependency specification.
- `README.md`: this file.

## Setup

1. Create and activate a Python environment (Python ≥ 3.10).
2. Install dependencies via `requirements.txt`:

```bash
python -m pip install -r requirements.txt
```

## Data Preparation

1. Download the Cranfield three-phase flow facility dataset (CVACaseStudy/MFP).
2. Place the `.mat` files under `Datasets/CVACaseStudy/MFP/` (create the directory locally; it is not tracked in this repository).
3. Run preprocessing to detrend signals, generate CWT scalograms, and save chunked tensors. Example command (adjust paths/flags as needed):

```bash
python preprocess_data.py \
	--transform_type wavelet \
	--data_dir Datasets/CVACaseStudy/MFP \
	--output_dir preprocessed_dataset \
	--chunk_width 2048 \
	--chunk_stride 64 \
	--detrend --detrend_window_size 4096
```

## Training & Evaluation

Train the primary ScaloVit-EBM model (Energy Matching, FM-only):

```bash
python train_ebm.py \
	--train_data_path preprocessed_dataset/train_chunks_wavelet_mag.pt \
	--val_data_path preprocessed_dataset/val_chunks_wavelet_mag.pt \
	--output_dir results/ebm_fm
```

Evaluate on the test sets and compute metrics:

```bash
python detect_anomalies.py \
	--ckpt path/to/checkpoint.pt \
	--val_data_path preprocessed_dataset/val_chunks_wavelet_mag.pt \
	--test_data_dir preprocessed_dataset \
	--output_dir results/ebm_detection
```

To reproduce ablations (Contrastive Divergence, alternative heads, aggregation strategies), use the corresponding scripts:

```bash
python train_ebm_ablation.py --lambda_cd 0.001 --output_dir results/ebm_cd
python detect_anomalies_ablation.py --ckpt path/to/cd_checkpoint.pt --output_dir results/ebm_cd_detection
```

Per-signal scoring and metrics utilities are exposed through `scalovit.scoring` and `scalovit.metrics`.
## Regenerating Figures and Baselines

The artefact branch focuses on core training and evaluation code. Plotting scripts and external baseline wrappers have been intentionally omitted; please refer to the full development repository if you need to recreate individual figures or baseline comparisons.

## Paper

Compile the LaTeX source under `paper/` to reproduce the manuscript:

```bash
cd paper
latexmk -pdf scaloVitEBM.tex
```

Figures needed for the paper are generated by the plotting scripts above and saved under `paper/figures/`.

## Contributing / Issues

Please open an issue on GitHub if you encounter problems recreating the experiments or if a dependency/version pin is missing.